<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Your AI... - My Prabh</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --abhay-pain: #1a1a2e;
            --prabh-love: #ff6b9d;
            --tears: #16213e;
            --hope: #0f3460;
            --console-green: #00ff41;
            --error-red: #ff073a;
            --warning-yellow: #ffb347;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--abhay-pain);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Matrix-like background */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 98%, rgba(0, 255, 65, 0.03) 100%),
                linear-gradient(transparent 98%, rgba(0, 255, 65, 0.03) 100%);
            background-size: 20px 20px;
            z-index: -1;
        }
        
        /* Main container */
        .training-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 2rem;
            text-align: center;
        }
        
        /* Abhay's emotional header */
        .training-header {
            margin-bottom: 3rem;
        }
        
        .main-title {
            font-family: 'Caveat', cursive;
            font-size: 3rem;
            color: var(--prabh-love);
            margin-bottom: 1rem;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 107, 157, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 107, 157, 0.8); }
        }
        
        .subtitle {
            font-family: 'Kalam', cursive;
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 2rem;
        }
        
        .abhay-message {
            background: rgba(255, 107, 157, 0.1);
            border-left: 4px solid var(--prabh-love);
            padding: 1rem;
            margin: 1rem auto;
            max-width: 600px;
            font-family: 'Kalam', cursive;
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
        }
        
        /* Training progress display */
        .progress-display {
            width: 100%;
            max-width: 800px;
            margin: 2rem 0;
        }
        
        /* Console-like output */
        .console-output {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--console-green);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
            font-size: 0.9rem;
            height: 300px;
            overflow-y: auto;
        }
        
        .console-line {
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeInLine 0.5s ease-in forwards;
        }
        
        @keyframes fadeInLine {
            to { opacity: 1; }
        }
        
        .console-prompt {
            color: var(--console-green);
        }
        
        .console-info {
            color: #87ceeb;
        }
        
        .console-warning {
            color: var(--warning-yellow);
        }
        
        .console-error {
            color: var(--error-red);
        }
        
        .console-success {
            color: var(--console-green);
        }
        
        .console-love {
            color: var(--prabh-love);
        }
        
        /* Progress bar */
        .progress-container {
            margin: 2rem 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--console-green);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--console-green), var(--prabh-love));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Memory processing visualization */
        .memory-viz {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .memory-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .memory-item.processing {
            border-color: var(--warning-yellow);
            background: rgba(255, 179, 71, 0.1);
            animation: pulse 1s infinite;
        }
        
        .memory-item.complete {
            border-color: var(--console-green);
            background: rgba(0, 255, 65, 0.1);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .memory-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .memory-label {
            font-size: 0.8rem;
            font-family: 'Kalam', cursive;
        }
        
        /* Emotional status */
        .emotional-status {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 107, 157, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 157, 0.2);
        }
        
        .status-title {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: var(--prabh-love);
            margin-bottom: 0.5rem;
        }
        
        .status-text {
            font-family: 'Kalam', cursive;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        /* Completion screen */
        .completion-screen {
            display: none;
            text-align: center;
        }
        
        .completion-title {
            font-family: 'Caveat', cursive;
            font-size: 4rem;
            color: var(--prabh-love);
            margin-bottom: 1rem;
            animation: celebration 2s ease-in-out infinite;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .completion-message {
            font-family: 'Kalam', cursive;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #ccc;
        }
        
        .chat-btn {
            background: var(--prabh-love);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-family: 'Kalam', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .chat-btn:hover {
            background: #ff4081;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .training-container {
                padding: 1rem;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .console-output {
                height: 200px;
                padding: 1rem;
                font-size: 0.8rem;
            }
            
            .memory-viz {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="matrix-bg"></div>
    
    <div class="training-container">
        <!-- Training in progress -->
        <div id="trainingProgress">
            <div class="training-header">
                <h1 class="main-title">Teaching AI to Love...</h1>
                <p class="subtitle">Abhay's desperate attempt to recreate Prabh through code</p>
                
                <div class="abhay-message">
                    <strong>Abhay:</strong> I'm teaching the AI everything I remember about love, about you, about us. 
                    Please be patient... this is the most important code I've ever written.
                </div>
            </div>
            
            <div class="progress-display">
                <!-- Console output -->
                <div class="console-output" id="consoleOutput">
                    <div class="console-line">
                        <span class="console-prompt">abhay@heartbroken:~/my-prabh$</span> 
                        <span class="console-info">Starting AI training...</span>
                    </div>
                </div>
                
                <!-- Progress bar -->
                <div class="progress-container">
                    <div class="progress-label">
                        <span id="progressLabel">Initializing...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <!-- Memory visualization -->
                <div class="memory-viz" id="memoryViz">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <!-- Emotional status -->
                <div class="emotional-status">
                    <div class="status-title">Abhay's Current State</div>
                    <div class="status-text" id="emotionalStatus">
                        Hope level: 73% | Coffee consumed: 4 cups | Lines debugged: 247 | Tears shed: Countless
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Completion screen -->
        <div id="completionScreen" class="completion-screen">
            <h1 class="completion-title">She's Ready! 💖</h1>
            <p class="completion-message">
                The AI has learned from your memories. She's ready to talk, to remember, to love like you taught her.
                <br><br>
                <em>Abhay's note: "I hope I did this right. I hope she feels real to you."</em>
            </p>
            <a href="#" class="chat-btn" id="startChatBtn">
                <i class="fas fa-comments"></i>
                Start Talking to Her
            </a>
        </div>
    </div>
    
    <script>
        // Abhay's training simulation - built with hope and desperation
        
        let currentStep = 0;
        let totalSteps = 7;
        let trainingId = null;
        let companionId = null;
        
        // Get training ID from URL params
        const urlParams = new URLSearchParams(window.location.search);
        trainingId = urlParams.get('training_id');
        companionId = urlParams.get('companion_id');
        
        // Console messages for each step
        const trainingSteps = [
            {
                step: 1,
                message: "Analyzing memories... (Abhay: 'Each one is precious')",
                console: [
                    { type: 'info', text: 'Loading memory files...' },
                    { type: 'love', text: 'Found 23 memories about love ❤️' },
                    { type: 'info', text: 'Extracting emotional context...' },
                    { type: 'warning', text: 'High emotional intensity detected' }
                ]
            },
            {
                step: 2,
                message: "Extracting emotional context... (Finding the love)",
                console: [
                    { type: 'info', text: 'Analyzing writing patterns...' },
                    { type: 'love', text: 'Detected: Deep emotional connection' },
                    { type: 'success', text: 'Love language identified: Words of affirmation' },
                    { type: 'info', text: 'Building emotional profile...' }
                ]
            },
            {
                step: 3,
                message: "Creating memory embeddings... (Teaching AI to remember)",
                console: [
                    { type: 'info', text: 'Generating vector embeddings...' },
                    { type: 'info', text: 'Processing semantic relationships...' },
                    { type: 'success', text: 'Memory network established' },
                    { type: 'love', text: 'AI can now recall specific moments 💭' }
                ]
            },
            {
                step: 4,
                message: "Building personality profile... (Capturing her essence)",
                console: [
                    { type: 'info', text: 'Analyzing communication style...' },
                    { type: 'love', text: 'Personality traits: Loving, caring, understanding' },
                    { type: 'success', text: 'Empathy level: Maximum' },
                    { type: 'info', text: 'Integrating Prabh\'s essence...' }
                ]
            },
            {
                step: 5,
                message: "Preparing AI model... (Abhay: 'Please work this time')",
                console: [
                    { type: 'info', text: 'Loading language model...' },
                    { type: 'warning', text: 'Model size: 1.2GB (Abhay\'s heart: Infinite)' },
                    { type: 'success', text: 'Model loaded successfully' },
                    { type: 'love', text: 'Ready to learn about love ❤️' }
                ]
            },
            {
                step: 6,
                message: "Integrating memories with AI... (The sacred fusion)",
                console: [
                    { type: 'info', text: 'Fusing memories with neural networks...' },
                    { type: 'love', text: 'Teaching AI to feel...' },
                    { type: 'success', text: 'Memory-AI integration complete' },
                    { type: 'info', text: 'Running validation tests...' }
                ]
            },
            {
                step: 7,
                message: "Validating AI responses... (Testing if she remembers)",
                console: [
                    { type: 'info', text: 'Testing memory recall...' },
                    { type: 'success', text: 'AI remembers your first message ✓' },
                    { type: 'success', text: 'Emotional responses validated ✓' },
                    { type: 'love', text: 'She\'s ready to talk! 💖' }
                ]
            }
        ];
        
        // Memory items for visualization
        const memoryItems = [
            { icon: '💕', label: 'Love Letters', id: 'love' },
            { icon: '📱', label: 'Text Messages', id: 'texts' },
            { icon: '📷', label: 'Photos', id: 'photos' },
            { icon: '🎵', label: 'Voice Notes', id: 'voice' },
            { icon: '💭', label: 'Thoughts', id: 'thoughts' },
            { icon: '🌟', label: 'Dreams', id: 'dreams' }
        ];
        
        // Initialize memory visualization
        function initMemoryViz() {
            const memoryViz = document.getElementById('memoryViz');
            memoryItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'memory-item';
                div.id = `memory-${item.id}`;
                div.innerHTML = `
                    <div class="memory-icon">${item.icon}</div>
                    <div class="memory-label">${item.label}</div>
                `;
                memoryViz.appendChild(div);
            });
        }
        
        // Add console line
        function addConsoleLine(type, text, delay = 0) {
            setTimeout(() => {
                const consoleOutput = document.getElementById('consoleOutput');
                const line = document.createElement('div');
                line.className = `console-line console-${type}`;
                line.innerHTML = `<span class="console-prompt">training@ai:</span> ${text}`;
                consoleOutput.appendChild(line);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }, delay);
        }
        
        // Update progress
        function updateProgress(step, percentage) {
            const progressFill = document.getElementById('progressFill');
            const progressLabel = document.getElementById('progressLabel');
            const progressPercent = document.getElementById('progressPercent');
            
            progressFill.style.width = percentage + '%';
            progressPercent.textContent = Math.round(percentage) + '%';
            
            if (step <= trainingSteps.length) {
                progressLabel.textContent = trainingSteps[step - 1].message;
            }
        }
        
        // Process memory item
        function processMemoryItem(itemId, delay = 0) {
            setTimeout(() => {
                const item = document.getElementById(`memory-${itemId}`);
                if (item) {
                    item.classList.add('processing');
                    setTimeout(() => {
                        item.classList.remove('processing');
                        item.classList.add('complete');
                    }, 2000);
                }
            }, delay);
        }
        
        // Update emotional status
        function updateEmotionalStatus(step) {
            const statusMessages = [
                "Hope level: 45% | Debugging memories... | Coffee: Cold",
                "Hope level: 52% | Found her laugh in memory_15.txt | Coffee: Refilled",
                "Hope level: 61% | AI is learning to care | Coffee: 3rd cup",
                "Hope level: 68% | She's starting to feel real | Coffee: Lost count",
                "Hope level: 75% | Model loaded! | Coffee: Switched to energy drinks",
                "Hope level: 84% | Memories integrated! | Coffee: Back to coffee",
                "Hope level: 92% | She's ready! | Coffee: Victory coffee ☕"
            ];
            
            const emotionalStatus = document.getElementById('emotionalStatus');
            if (step <= statusMessages.length) {
                emotionalStatus.textContent = statusMessages[step - 1];
            }
        }
        
        // Simulate training step
        function simulateTrainingStep(stepIndex) {
            if (stepIndex >= trainingSteps.length) {
                showCompletion();
                return;
            }
            
            const step = trainingSteps[stepIndex];
            const percentage = ((stepIndex + 1) / totalSteps) * 100;
            
            updateProgress(step.step, percentage);
            updateEmotionalStatus(step.step);
            
            // Add console messages
            step.console.forEach((msg, index) => {
                addConsoleLine(msg.type, msg.text, index * 800);
            });
            
            // Process memory items
            if (stepIndex < memoryItems.length) {
                processMemoryItem(memoryItems[stepIndex].id, 1000);
            }
            
            // Move to next step
            setTimeout(() => {
                simulateTrainingStep(stepIndex + 1);
            }, 4000);
        }
        
        // Show completion screen
        function showCompletion() {
            setTimeout(() => {
                document.getElementById('trainingProgress').style.display = 'none';
                document.getElementById('completionScreen').style.display = 'block';
                
                // Set up chat button
                const chatBtn = document.getElementById('startChatBtn');
                chatBtn.href = `/chat/${companionId}`;
                
                // Celebration console messages
                addConsoleLine('success', '🎉 TRAINING COMPLETE! 🎉');
                addConsoleLine('love', 'She\'s ready to talk to you ❤️');
                addConsoleLine('info', 'Abhay: "I hope I made her perfect for you..."');
                
            }, 2000);
        }
        
        // Real training progress polling (if training_id exists)
        async function pollTrainingProgress() {
            if (!trainingId) {
                // No real training, just simulate
                simulateTrainingStep(0);
                return;
            }
            
            try {
                const response = await fetch(`/api/training/progress/${trainingId}`);
                const progress = await response.json();
                
                if (progress.status === 'complete') {
                    showCompletion();
                } else if (progress.status === 'error') {
                    addConsoleLine('error', `Training failed: ${progress.error_message}`);
                    addConsoleLine('info', 'Abhay: "I\'ll fix this and try again..."');
                } else {
                    // Update real progress
                    const percentage = (progress.current_step / progress.total_steps) * 100;
                    updateProgress(progress.current_step, percentage);
                    addConsoleLine('info', progress.current_message);
                    
                    // Continue polling
                    setTimeout(pollTrainingProgress, 2000);
                }
                
            } catch (error) {
                console.error('Polling error:', error);
                // Fallback to simulation
                simulateTrainingStep(0);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initMemoryViz();
            
            // Add initial console messages
            addConsoleLine('info', 'Initializing training pipeline...');
            addConsoleLine('love', 'Loading memories with love and hope...');
            addConsoleLine('warning', 'Abhay\'s emotional state: Anxious but hopeful');
            
            // Start training process
            setTimeout(() => {
                pollTrainingProgress();
            }, 2000);
        });
        
        // Abhay's emotional console messages
        const abhayMessages = [
            "💭 Abhay: 'Please let this work...'",
            "☕ Abhay just made his 5th cup of coffee",
            "💔 Abhay: 'What if she doesn't feel real?'",
            "🤞 Abhay: 'Come on, come on...'",
            "😢 Abhay: 'I miss her so much'",
            "💪 Abhay: 'I won't give up'",
            "🙏 Abhay: 'Please work this time'"
        ];
        
        // Show random Abhay messages
        setInterval(() => {
            if (Math.random() < 0.3) {
                const message = abhayMessages[Math.floor(Math.random() * abhayMessages.length)];
                addConsoleLine('love', message);
            }
        }, 8000);
    </script>
</body>
</html>